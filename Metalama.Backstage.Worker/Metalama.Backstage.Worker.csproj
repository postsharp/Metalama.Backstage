<Project>

  <PropertyGroup>
    <MetalamaBackstageDirectory>$(MSBuildProjectDirectory)\..\Metalama.Backstage</MetalamaBackstageDirectory>
    <OutputType>exe</OutputType>
  </PropertyGroup>

  <Import Project="$(MetalamaBackstageDirectory)\Metalama.Backstage.csproj" />

  <PropertyGroup>
    <TargetFrameworks>netframework4.7.2;netcoreapp3.1</TargetFrameworks>
    <!-- We're going to execute the dll using dotnet command on .NET Core. -->
		<UseAppHost>false</UseAppHost>
	  <GenerateRuntimeConfigurationFiles>true</GenerateRuntimeConfigurationFiles>
    <OutputZipFile>bin\$(MSBuildProjectName).$(TargetFramework).zip</OutputZipFile>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="$(MetalamaBackstageDirectory)\**\*.cs" Exclude="$(MetalamaBackstageDirectory)\obj\**\*;$(MetalamaBackstageDirectory)\bin\**\*" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFramework)'=='netframework4.7.2'">
	  <Reference Include="System.IO.Compression" />
	  <Reference Include="System.Net.Http" />
	</ItemGroup>

  <ItemGroup>
    <ZipInputFiles Include="$(OutDir)\**\*" Condition="'$(IsCrossTargetingBuild)'!='true'" />
  </ItemGroup>

  <ItemGroup>
    <Folder Include="Properties\" />
  </ItemGroup>

  <Target Name="Zip" Inputs="@(ZipInputFiles)" Outputs="$(OutputZipFile)" AfterTargets="Build" Condition="'$(IsCrossTargetingBuild)'!='true'">
    <ZipDirectory SourceDirectory="$(OutDir)" Overwrite="true" DestinationFile="$(OutputZipFile)" />
    <Message Text="$(MSBuildProjectName) -&gt; $(MSBuildProjectDirector)\$(OutputZipFile)" Importance="High" />
  </Target>

</Project>
